Validating and Mutating Admission Controllers

Les admission controllers dans Kubernetes sont des composants qui interceptent
les requÃªtes envoyÃ©es Ã  l'API server aprÃ¨s l'authentification et l'autorisation,
mais avant que l'objet ne soit stockÃ© dans etcd.

Il en existe deux types principaux :

ğŸ› ï¸ 1. Mutating Admission Controllers
Objectif : Modifier les objets avant quâ€™ils ne soient enregistrÃ©s dans Kubernetes.
Exemple dâ€™usage :
Ajouter des labels ou annotations automatiquement.
Injecter un sidecar (comme le fait Istio ou Linkerd).
ComplÃ©ter les champs par dÃ©faut.
Fonctionnement : Ils reÃ§oivent la requÃªte et peuvent modifier le contenu (patch JSON).
Exemple concret : Ajouter automatiquement resources.limits si l'utilisateur ne les a pas dÃ©finis.

ğŸ” 2. Validating Admission Controllers
Objectif : VÃ©rifier que la requÃªte est conforme Ã  certaines rÃ¨gles avant qu'elle ne soit acceptÃ©e.
Ils ne modifient rien.
Exemple dâ€™usage :
Rejeter un pod sâ€™il utilise lâ€™image latest.
Interdire les volumes hostPath.
Sâ€™assurer que les noms respectent un certain pattern.
Fonctionnement : La requÃªte est examinÃ©e, et si elle ne respecte pas les rÃ¨gles, elle est rejetÃ©e avec une erreur.

ğŸ“‹ Ordre dâ€™exÃ©cution :
Mutating admission controllers sont appelÃ©s en premier.
Lâ€™objet modifiÃ© est ensuite validÃ© par les Validating admission controllers.
Si tout est bon, il est persistÃ© dans etcd.
âœ¨ Exemples d'admission controllers intÃ©grÃ©s :
MutatingAdmissionWebhook : permet aux webhooks externes de modifier des requÃªtes.
ValidatingAdmissionWebhook : permet Ã  des webhooks externes de les valider.
NamespaceLifecycle, LimitRanger, PodSecurity, etc.
ğŸ”§ Webhooks Admission Controllers
Kubernetes permet aussi dâ€™enregistrer des admission webhooks dynamiques, qui sont :

MutatingAdmissionWebhook
ValidatingAdmissionWebhook
Ces webhooks permettent dâ€™appeler des services externes (souvent Ã©crits en Go, Python, etc.) pour effectuer des mutations ou des validations spÃ©cifiques Ã  votre organisation.
